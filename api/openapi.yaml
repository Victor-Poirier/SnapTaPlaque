openapi: 3.0.0
info:
  title: API SnapTaPlaque - Reconnaissance de Plaques d'Immatriculation
  description: |
    API de reconnaissance de plaques d'immatriculation basée sur un modèle YOLO + EasyOCR.
    Projet DevOps - Master 1 Informatique parcours IA, Université du Mans.
  contact:
    email: vincent.proudy.etu@univ-lemans.fr
  license:
    name: CeCILL 2.1
    url: https://cecill.info/licences/Licence_CeCILL_V2.1-en.html
  version: 1.0.0
servers:
- url: http://localhost:8000
  description: Local development server
paths:
  /health:
    get:
      summary: Vérifier l'état de l'API
      responses:
        "200":
          description: API opérationnelle
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"
  /auth/register:
    post:
      summary: Inscription d'un nouvel utilisateur
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCreate"
        required: true
      responses:
        "201":
          description: Utilisateur créé
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "400":
          description: Email ou username déjà existant
  /auth/login:
    post:
      summary: Authentification utilisateur
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: "#/components/schemas/auth_login_body"
        required: true
      responses:
        "200":
          description: Token JWT
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Token"
        "401":
          description: Credentials invalides
  /auth/me:
    get:
      summary: Récupérer les informations de l'utilisateur connecté
      responses:
        "200":
          description: Informations utilisateur
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "401":
          description: Utilisateur non authentifié
  /predict:
    post:
      summary: Détecter et lire une plaque d'immatriculation sur une image
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/PlateDetectionRequest"
        required: true
      responses:
        "200":
          description: Résultat de la détection de plaque
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlateDetectionResponse"
        "400":
          description: Image invalide ou requête incorrecte
        "500":
          description: Erreur interne du serveur
  /predictions/history:
    get:
      summary: Récupérer l'historique des détections de plaques
      responses:
        "200":
          description: Liste des détections
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DetectionHistory"
        "401":
          description: Utilisateur non authentifié
  /predictions/stats:
    get:
      summary: Statistiques des détections de l'utilisateur
      responses:
        "200":
          description: Statistiques utilisateur
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DetectionStats"
        "401":
          description: Utilisateur non authentifié
  /admin/users:
    get:
      summary: Liste de tous les utilisateurs (admin only)
      responses:
        "200":
          description: Liste des utilisateurs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserResponse"
        "401":
          description: Admin non authentifié
  /admin/stats:
    get:
      summary: Statistiques globales (admin only)
      responses:
        "200":
          description: Statistiques globales
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserStats"
        "401":
          description: Admin non authentifié
  /model/info:
    get:
      summary: Informations sur le modèle de détection
      responses:
        "200":
          description: Métadonnées du modèle
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelInfo"
        "500":
          description: Erreur interne du serveur
components:
  schemas:
    PlateDetectionRequest:
      required:
      - file
      type: object
      properties:
        file:
          type: string
          format: binary
          description: Image contenant un véhicule avec plaque d'immatriculation
    PlateDetectionResponse:
      type: object
      properties:
        plate_text:
          type: string
          description: Texte lu sur la plaque d'immatriculation
          example: AB-123-CD
        confidence:
          type: number
          format: float
          description: Score de confiance de la détection
          example: 0.95
        bounding_box:
          type: object
          properties:
            x_min:
              type: integer
              example: 120
            y_min:
              type: integer
              example: 340
            x_max:
              type: integer
              example: 380
            y_max:
              type: integer
              example: 410
        model_version:
          type: string
          example: yolov8_plate_v1
        prediction_id:
          type: integer
          example: 123
    UserCreate:
      required:
      - email
      - password
      - username
      type: object
      properties:
        username:
          type: string
          example: vincent_prd
        email:
          type: string
          example: vincent@example.com
        password:
          type: string
          example: Password123
    UserResponse:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: vincent_prd
        email:
          type: string
          example: vincent@example.com
        is_active:
          type: boolean
          example: true
        is_admin:
          type: boolean
          example: false
    Token:
      type: object
      properties:
        access_token:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        token_type:
          type: string
          example: bearer
    DetectionHistory:
      type: object
      properties:
        id:
          type: integer
          example: 1
        plate_text:
          type: string
          example: AB-123-CD
        confidence:
          type: number
          format: float
          example: 0.95
        created_at:
          type: string
          format: date-time
    DetectionStats:
      type: object
      properties:
        total_detections:
          type: integer
          example: 120
        successful_reads:
          type: integer
          description: Nombre de plaques lues avec succès
          example: 105
        failed_reads:
          type: integer
          description: Nombre de détections sans lecture réussie
          example: 15
        average_confidence:
          type: number
          format: float
          example: 0.89
    UserStats:
      type: object
      properties:
        total_users:
          type: integer
          example: 50
        active_users:
          type: integer
          example: 45
        admin_users:
          type: integer
          example: 5
    ModelInfo:
      type: object
      properties:
        model_name:
          type: string
          example: SnapTaPlaque - YOLO + EasyOCR
        algorithm:
          type: string
          example: YOLOv8 + EasyOCR
        version:
          type: string
          example: "1.0"
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: healthy
        model_loaded:
          type: boolean
          example: true
        database:
          type: string
          example: connected
        version:
          type: string
          example: "1.0"
    auth_login_body:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
