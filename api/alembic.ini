# ==============================================================================
# Alembic Configuration File (alembic.ini)
# ==============================================================================
# This file configures Alembic, the database migration tool used by the
# SnapTaPlaque API to manage PostgreSQL schema changes (tables, columns, etc.)
# in a versioned and reproducible manner.
#
# Alembic works alongside SQLAlchemy models defined in `api/app/database.py`
# and the migration environment configured in `api/alembic/env.py`.
#
# Usage:
#   - Generate a new migration:
#       alembic revision --autogenerate -m "description"
#   - Apply all pending migrations:
#       alembic upgrade head
#   - Rollback the last migration:
#       alembic downgrade -1
#   - Show current migration revision:
#       alembic current
#
# NOTE: The `sqlalchemy.url` value below is a fallback default. It is
#       overridden at runtime by `env.py` using the `DATABASE_URL` from
#       `app.config.settings`, which reads from environment variables
#       (typically set via docker-compose.yml).
# ==============================================================================

[alembic]
# Path to the directory containing migration scripts and the env.py file.
# Relative to the location of this alembic.ini file (i.e., api/alembic/).
script_location = alembic

# Naming template for auto-generated migration files.
# Produces filenames like: 20250226_0916_a1b2c3d4e5f6_add_users_table.py
# Placeholders:
#   %%(year)d / %%(month)d / %%(day)d / %%(hour)d / %%(minute)d — timestamp parts
#   %%(rev)s   — unique revision identifier
#   %%(slug)s  — slugified version of the migration message
file_template = %%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d_%%(rev)s_%%(slug)s

# Default database connection URL (fallback).
# In production / Docker, this is overridden by env.py which reads
# DATABASE_URL from app.config.settings (environment variable).
# Format: postgresql://<user>:<password>@<host>:<port>/<database>
sqlalchemy.url = postgresql://plate_user:plate_password@localhost:5432/snaptaplaque_db

# Timezone used for migration file timestamps
timezone = UTC

# Post-write hooks can be configured here to auto-format generated migration
# files (e.g., with black or ruff). Currently unused.
[post_write_hooks]

# ==============================================================================
# Logging Configuration
# ==============================================================================
# Standard Python logging configuration for Alembic.
# Controls verbosity of Alembic operations, SQLAlchemy engine output,
# and the root logger.

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

# Root logger — captures all unhandled log messages at WARN level and above
[logger_root]
level = WARN
handlers = console
qualname =

# SQLAlchemy engine logger — set to WARN to suppress verbose SQL query output.
# Change to INFO or DEBUG to see generated SQL statements during migrations.
[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

# Alembic logger — set to INFO to display migration progress messages
# (e.g., "Running upgrade <rev1> -> <rev2>, <message>")
[logger_alembic]
level = INFO
handlers =
qualname = alembic

# Console handler — outputs log messages to stderr
[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

# Generic log formatter — produces lines like:
#   INFO  [alembic.runtime.migration] Running upgrade -> a1b2c3, initial tables
[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
